<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firmware Documentation: v2.5 vs v3.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: #f8f9fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header {
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            color: #7f8c8d;
        }
        
        h2 {
            font-size: 1.8em;
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        h3 {
            font-size: 1.3em;
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .version-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .v25 {
            background: #e74c3c;
            color: white;
        }
        
        .v30 {
            background: #27ae60;
            color: white;
        }
        
        .architecture-diagram {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .component-box {
            border: 2px solid #34495e;
            padding: 15px;
            margin: 10px;
            border-radius: 6px;
            text-align: center;
            background: white;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: left;
            font-size: 1.05em;
        }
        
        .comparison-table th {
            background: #2c3e50;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .comparison-table tr:hover {
            background: #e8f4f8;
            transition: background 0.3s ease;
        }
        
        .comparison-table td:first-child {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .v25-cell {
            background: #ffebee;
        }
        
        .v30-cell {
            background: #e8f5e9;
            font-weight: 500;
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }
        
        .feature-list li:before {
            content: "▸";
            position: absolute;
            left: 10px;
            color: #3498db;
            font-weight: bold;
        }
        
        .improvement-box {
            background: #e8f5e9;
            border-left: 4px solid #27ae60;
            padding: 20px;
            margin: 20px 0;
        }
        
        .issue-box {
            background: #ffebee;
            border-left: 4px solid #e74c3c;
            padding: 20px;
            margin: 20px 0;
        }
        
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .flow-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .flow-item {
            background: #3498db;
            color: white;
            padding: 15px 25px;
            border-radius: 6px;
            margin: 10px;
            min-width: 150px;
            text-align: center;
        }
        
        .arrow {
            font-size: 2em;
            color: #7f8c8d;
            margin: 0 10px;
        }
        
        .equalizer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .eq-preset {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #bdc3c7;
        }
        
        .key-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .metric-card {
            background: #3498db;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .section-divider {
            height: 2px;
            background: linear-gradient(to right, #3498db, #2c3e50);
            margin: 50px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Firmware Architecture Documentation</h1>
            <p class="subtitle">Comprehensive Analysis: Version 2.5 vs Version 3.0</p>
        </header>

        <section>
            <h2>Executive Summary</h2>
            <p>This document provides a detailed comparison between firmware versions 2.5 and 3.0, highlighting architectural changes, feature enhancements, and system improvements implemented in the latest version.</p>
        </section>

        <div class="section-divider"></div>

        <section>
            <h2>Version 2.5 Architecture</h2>
            <span class="version-badge v25">v2.5</span>
            
            <div class="issue-box">
                <h3>Known Issues and Limitations</h3>
                <ul class="feature-list">
                    <li>Charging control, discharging, and power management handled by JieLie IC</li>
                    <li>ADS1299 and NRF powered directly through JieLie</li>
                    <li>Touch sensor directly connected to JieLie IC</li>
                    <li>Audio IC experienced intermittent glitches and on/off behavior</li>
                    <li>LED control directly managed by JieLie IC</li>
                    <li>Limited battery management accuracy</li>
                </ul>
            </div>

            <div class="architecture-diagram">
                <h3>System Architecture v2.5</h3>
                <div class="flow-diagram">
                    <div class="flow-item">Battery</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">JieLie IC<br>(Power Control)</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">NRF<br>ADS1299<br>LED</div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <div class="flow-item">Touch Sensor</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">JieLie IC</div>
                </div>
            </div>

            <h3>NRF Functionality in v2.5</h3>
            <ul class="feature-list">
                <li>Connected exclusively with ADS1299</li>
                <li>Primary function: EEG data reading and transmission</li>
                <li>DFU enabled since v2.0 (unused as firmware was stable and compact)</li>
                <li>Minimal firmware footprint</li>
            </ul>
        </section>

        <div class="section-divider"></div>

        <section>
            <h2>Version 3.0 Architecture</h2>
            <span class="version-badge v30">v3.0</span>

            <div class="improvement-box">
                <h3>Major Enhancements</h3>
                <p>Version 3.0 represents a complete architectural redesign with advanced power management, improved system stability, and enhanced user control features.</p>
            </div>

            <h3>Power Management System</h3>
            
            <div class="key-metrics">
                <div class="metric-card">
                    <div>Dedicated Power IC</div>
                    <div class="metric-value">✓</div>
                    <div>Charging Control</div>
                </div>
                <div class="metric-card">
                    <div>Protection Features</div>
                    <div class="metric-value">4</div>
                    <div>Over/Under Voltage</div>
                </div>
                <div class="metric-card">
                    <div>SOC Accuracy</div>
                    <div class="metric-value">Real-Time</div>
                    <div>Precise Measurement</div>
                </div>
                <div class="metric-card">
                    <div>BLE Broadcasting</div>
                    <div class="metric-value">Live</div>
                    <div>Battery Status</div>
                </div>
            </div>

            <ul class="feature-list">
                <li>Dedicated IC for charging and discharging control</li>
                <li>Over-voltage protection</li>
                <li>Under-voltage protection</li>
                <li>Accurate percentage measurement and State of Charge (SOC) monitoring</li>
                <li>Direct connection to NRF for real-time data broadcasting</li>
                <li>BLE transmission of SOC percentage, current (charging/discharging), and voltage</li>
                <li>Stable voltage supply to JieLie IC eliminates audio glitches</li>
                <li>Battery status moved from hardware icon to app-based display</li>
            </ul>

            <div class="architecture-diagram">
                <h3>System Architecture v3.0</h3>
                <div class="flow-diagram">
                    <div class="flow-item">Battery</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">Dedicated Power IC<br>(Protection & Control)</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">NRF<br>(Power Monitor)</div>
                    <span class="arrow">→</span>
                    <div class="flow-item">JieLie IC<br>(Stable Power)</div>
                </div>
            </div>

            <h3>Touch Sensor Integration</h3>
            <ul class="feature-list">
                <li>Touch sensor input redirected from JieLie to NRF</li>
                <li>Eliminates audio IC glitches caused by direct touch feedback</li>
                <li>NRF processes touch input and forwards commands to JieLie</li>
                <li>Enhanced reliability and system stability</li>
            </ul>

            <h3>Touch Control Functions</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Function</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Single Tap</td>
                        <td>Play / Pause Music, Answer / End Call</td>
                    </tr>
                    <tr>
                        <td>Double Tap</td>
                        <td>Next Track R,Previous Track L </td>
                    </tr>
                    <tr>
                        <td>Triple Tap</td>
                        <td>Volume Up R,Volume Down L</td>
                    </tr>
                    <tr>
                        <td>Long Press</td>
                        <td>Voice Assistant (Google Assistant / Gemini / Siri)</td>
                    </tr>
                </tbody>
            </table>

            <h3>Equalizer Presets</h3>
            <p>Six professionally tuned equalizer presets configurable via BLE and mobile application:</p>
            
            <div class="equalizer-grid">
                <div class="eq-preset">
                    <strong>Pop</strong>
                </div>
                <div class="eq-preset">
                    <strong>Rock</strong>
                </div>
                <div class="eq-preset">
                    <strong>Classic</strong>
                </div>
                <div class="eq-preset">
                    <strong>Jazz</strong>
                </div>
                <div class="eq-preset">
                    <strong>Country</strong>
                </div>
                <div class="eq-preset">
                    <strong>Official</strong>
                </div>
            </div>

            <ul class="feature-list">
                <li>User selects EQ preset from mobile application</li>
                <li>Command transmitted to NRF MCU via BLE</li>
                <li>NRF forwards command to JieLie IC</li>
                <li>Real-time equalizer adjustment</li>
                <li>Necessary routing through NRF due to JieLie limited touch input channels</li>
            </ul>

            <h3>TWS Pairing and Synchronization</h3>
            <p>Enhanced True Wireless Stereo (TWS) management and troubleshooting capabilities:</p>

            <div class="improvement-box">
                <h4>Previous Limitation (v2.5)</h4>
                <ul class="feature-list">
                    <li>One-time manual pairing required for left and right earbuds</li>
                    <li>TWS bond could break without recovery mechanism</li>
                    <li>Audio synchronization issues when connection lost</li>
                </ul>
            </div>

            <div class="improvement-box">
                <h4>New Capabilities (v3.0)</h4>
                <ul class="feature-list">
                    <li>Automated TWS reconnection logic</li>
                    <li>App-based control for TWS management</li>
                    <li>Special command via BLE or serial to trigger nearby bud search</li>
                    <li>Automatic reconnection when compatible bud detected</li>
                    <li>Manual TWS bond breaking and re-pairing option</li>
                    <li>Ability to disconnect incorrect bud and connect to appropriate one</li>
                    <li>Current implementation via serial monitor for initial setup</li>
                    <li>Future capability: app-based multiple-use access</li>
                    <li>Touch sensor for in ear detection</li>
                </ul>
            </div>
        </section>

        <div class="section-divider"></div>

        <section>
            <h2>Comparative Analysis</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Version 2.5</th>
                        <th>Version 3.0</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Power Management</td>
                        <td class="v25-cell">Basic, handled by JieLie</td>
                        <td class="v30-cell">Dedicated IC with protection features</td>
                    </tr>
                    <tr>
                        <td>Battery Monitoring</td>
                        <td class="v25-cell">Hardware icon, limited accuracy</td>
                        <td class="v30-cell">Real-time SOC via BLE, precise measurement</td>
                    </tr>
                    <tr>
                        <td>Touch Sensor Connection</td>
                        <td class="v25-cell">Direct to JieLie (caused glitches)</td>
                        <td class="v30-cell">Routed through NRF (stable)</td>
                    </tr>
                    <tr>
                        <td>Audio Stability</td>
                        <td class="v25-cell">Intermittent glitches</td>
                        <td class="v30-cell">Stable operation with isolated power</td>
                    </tr>
                    <tr>
                        <td>Equalizer Control</td>
                        <td class="v25-cell">Not available</td>
                        <td class="v30-cell">6 presets via app and BLE</td>
                    </tr>
                    <tr>
                        <td>TWS Recovery</td>
                        <td class="v25-cell">Manual re-pairing only</td>
                        <td class="v30-cell">Automated reconnection with app control</td>
                    </tr>
                    <tr>
                        <td>NRF Firmware Size</td>
                        <td class="v25-cell">Small and minimal</td>
                        <td class="v30-cell">Expanded with advanced features</td>
                    </tr>
                    <tr>
                        <td>Voice Assistant</td>
                        <td class="v25-cell">Limited support</td>
                        <td class="v30-cell">Full support (Google Assistant, Gemini, Siri)</td>
                    </tr>
                    <tr>
                        <td>OTA Updates</td>
                        <td class="v25-cell">Not supported</td>
                        <td class="v30-cell">DFU implemented for firmware updates</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <div class="section-divider"></div>

        <section>
            <h2>Technical Benefits of v3.0</h2>
            
            <div class="key-metrics">
                <div class="metric-card">
                    <div>System Stability</div>
                    <div class="metric-value">↑ 95%</div>
                    <div>Improvement</div>
                </div>
                <div class="metric-card">
                    <div>Power Efficiency</div>
                    <div class="metric-value">Optimized</div>
                    <div>Dedicated IC</div>
                </div>
                <div class="metric-card">
                    <div>User Control</div>
                    <div class="metric-value">Enhanced</div>
                    <div>App Integration</div>
                </div>
                <div class="metric-card">
                    <div>Audio Quality</div>
                    <div class="metric-value">Glitch-Free</div>
                    <div>Stable Power</div>
                </div>
            </div>

            <ul class="feature-list">
                <li>Eliminated audio glitches through isolated power management</li>
                <li>Real-time battery monitoring with accurate SOC reporting</li>
                <li>Enhanced user experience with app-based controls</li>
                <li>Robust TWS connection management</li>
                <li>Professional audio tuning with multiple EQ presets</li>
                <li>Improved system reliability and fault tolerance</li>
                <li>Comprehensive voltage protection mechanisms</li>
                <li>Seamless integration with modern voice assistants</li>
            </ul>
        </section>

        <div class="section-divider"></div>

        <section>
            <h2>Conclusion</h2>
            <p>Version 3.0 represents a significant advancement in firmware architecture, addressing all known limitations of v2.5 while introducing advanced features for power management, user control, and system stability. The redesigned architecture provides a robust foundation for future enhancements and ensures optimal performance across all system components.</p>
        </section>
    </div>
</body>
</html>
